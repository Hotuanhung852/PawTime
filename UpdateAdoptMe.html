<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PawTime</title>
    <link rel="stylesheet" href="../assets/css/petsitter.css">
    <script type="text/javascript" src="./assets/js/app.js" defer></script>
    <link rel="shortcut icon" href="../favicon.svg" type="image/svg+xml">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
</head>

<body>
    <nav id="sidebar">
        <ul>
            <li>
                <span class="logo">Pet Sitter</span>
                <button onclick=toggleSidebar() id="toggle-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                        fill="#e8eaed">
                        <path
                            d="m313-480 155 156q11 11 11.5 27.5T468-268q-11 11-28 11t-28-11L228-452q-6-6-8.5-13t-2.5-15q0-8 2.5-15t8.5-13l184-184q11-11 27.5-11.5T468-692q11 11 11 28t-11 28L313-480Zm264 0 155 156q11 11 11.5 27.5T732-268q-11 11-28 11t-28-11L492-452q-6-6-8.5-13t-2.5-15q0-8 2.5-15t8.5-13l184-184q11-11 27.5-11.5T732-692q11 11 11 28t-11 28L577-480Z" />
                    </svg>
                </button>
            </li>
            <li>
                <a href="PetSitter.html">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                        fill="#e8eaed">
                        <path
                            d="M560-680v-80h320v80H560Zm0 160v-80h320v80H560Zm0 160v-80h320v80H560Zm-240-40q-50 0-85-35t-35-85q0-50 35-85t85-35q50 0 85 35t35 85q0 50-35 85t-85 35ZM80-160v-76q0-21 10-40t28-30q45-27 95.5-40.5T320-360q56 0 106.5 13.5T522-306q18 11 28 30t10 40v76H80Z" />
                    </svg>
                    <span>Service Request Post</span>
                </a>
            </li>
            <li class="active">
                <a href="UpdateAdoptMe.html">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                        fill="#e8eaed">
                        <path
                            d="M194-80v-395h80v315h280v-193l105-105q29-29 45-65t16-77q0-40-16.5-76T659-741l-25-26-127 127H347l-43 43-57-56 67-67h160l160-160 82 82q40 40 62 90.5T800-600q0 57-22 107.5T716-402l-82 82v240H194Zm197-187L183-475q-11-11-17-26t-6-31q0-16 6-30.5t17-25.5l84-85 124 123q28 28 43.5 64.5T450-409q0 40-15 76.5T391-267Z" />
                    </svg>
                    <span>Adopt Me Post</span>
                </a>
            </li>
        </ul>
    </nav>

    <main>
        <a href="../PetTimer.html" style="text-decoration: none;">
            <button class="back-button">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                    fill="#e8eaed">
                    <path d="m368-417 202 202-90 89-354-354 354-354 90 89-202 202h466v126H368Z" />
                </svg>
                <span style="color: white;">Back</span>
            </button>
        </a>

        <div id="role-check">
            <!-- Phần này luôn hiển thị form Add New Pet -->
            <section class="section petboarding-form" aria-label="form" id="petboarding-form">
                <div class="icon-wrapper">
                    <i class="fas fa-paw"></i>
                </div>
                <h3>Add New Pet</h3>
                <form action="" class="form-add-pet" id="form">
                    <div class="form-add-pet-group">
                        <label for="name" class="form-label">Name</label>
                        <input type="text" name="name" id="name" placeholder="Enter pet name" class="form-control">
                    </div>
                    <div class="form-add-pet-group">
                        <label for="weight" class="form-label">Weight</label>
                        <input type="number" name="weight" id="weight" placeholder="Enter pet weight"
                            class="form-control">
                    </div>
                    <div class="form-add-pet-group">
                        <label for="gender" class="form-label">Gender</label>
                        <select name="gender" id="gender" class="form-control">
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                        </select>
                    </div>
                    <div class="form-add-pet-group">
                        <label for="isCat" class="form-label">Pet Type</label>
                        <select name="isCat" id="isCat" class="form-control" required>
                            <option value="true">Cat</option>
                            <option value="false">Dog</option>
                        </select>
                    </div>
                    <div class="form-add-pet-group">
                        <label for="phone" class="form-label">Phone</label>
                        <input type="tel" name="phone" id="phone" placeholder="Enter owner phone number"
                            class="form-control">
                    </div>
                    <div class="form-add-pet-group">
                        <label for="date" class="form-label">Date</label>
                        <input type="date" name="date" id="date" class="form-control">
                    </div>
                    <div class="form-add-pet-group">
                        <label for="imageURL" class="form-label">Image URL</label>
                        <input type="url" name="imageURL" id="imageURL" placeholder="Enter image URL"
                            class="form-control">
                    </div>
                    <div class="form-add-pet-group">
                        <label for="details" class="form-label">Details</label>
                        <textarea name="details" id="details" cols="30" rows="10" class="form-control"></textarea>
                    </div>
                    <button type="submit" class="btn-add-pet">Submit</button>
                </form>
                <div id="success-notification" style="display:none;">Pet added successfully!... Wait for seconds to
                    reload the page ..</div>
            </section>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // Không cần kiểm tra username hay vai trò người dùng
                document.getElementById('petboarding-form').style.display = "block";
            });
        </script>


        <section class="section product" id="shop" aria-label="product">
            <div class="container">
                <!-- Product List -->
                <div class="grid-list-pets">
                    <!-- Cột cho Mèo -->
                    <div class="column cat-column">
                        <h3 style="color: white;">Cats</h3>
                        <ul class="pet-list" id="cat-list"></ul>
                    </div>
                    <hr class="divider">
                    <!-- Cột cho Chó -->
                    <div class="column dog-column">
                        <h3 style="color: white;">Dogs</h3>
                        <ul class="pet-list" id="dog-list"></ul>
                    </div>
                </div>
            </div>
        </section>


        <script>
            document.addEventListener('DOMContentLoaded', async () => {
                // Fetch existing pets and populate the lists
                try {
                    const response = await fetch("https://pawtime-service.onrender.com/pets");
                    if (response.ok) {
                        const pets = await response.json();

                        const catList = document.getElementById('cat-list');
                        const dogList = document.getElementById('dog-list');

                        pets.forEach(pet => {
                            const petItem = document.createElement('li');
                            petItem.classList.add('product-card'); // Adding class to match card style

                            petItem.innerHTML = `
                            <div class="card-banner img-holder">
                                <img src="${pet.imageURL}" loading="lazy" alt="${pet.name}" class="img-cover default">
                            </div>
                            <div class="card-content">
                                <div class="pet-details">
                                    <p><strong>Name:</strong> ${pet.name}</p>
                                    <p><strong>Weight:</strong> ${pet.weight}kg</p>
                                    <p><strong>Gender:</strong> ${pet.gender}</p>
                                    <p><strong>Phone:</strong> ${pet.phone}</p>
                                    <p><strong>Details:</strong> ${pet.details.length > 50 ? pet.details.substring(0, 50) + '...' : pet.details}</p>
                                    <div class="button-group">
                                        <button class="btn-detail" onclick="window.location.href='viewPetDetails.html?id=${pet.id}'">
                                            <i class="fas fa-info-circle"></i>
                                            <span class="tooltip">View</span>
                                        </button>
                                        <button class="btn-edit" onclick="editPet('${pet.id}')">
                                            <i class="fas fa-edit"></i>
                                            <span class="tooltip">Edit</span>
                                        </button>
                                        <button class="btn-delete" onclick="deletePet('${pet.id}')">
                                            <i class="fas fa-trash"></i>
                                            <span class="tooltip">Delete</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;

                            // Add the pet item to the correct list
                            if (pet.isCat) {
                                catList.appendChild(petItem); // Add to Cats list
                            } else {
                                dogList.appendChild(petItem); // Add to Dogs list
                            }
                        });
                    } else {
                        console.error('Failed to fetch pets');
                    }
                } catch (error) {
                    console.error('Error fetching pets:', error);
                }
            });

            document.getElementById('form').addEventListener('submit', async (event) => {
                event.preventDefault();

                const petData = {
                    name: document.getElementById('name').value,
                    weight: document.getElementById('weight').value,
                    gender: document.getElementById('gender').value,
                    phone: document.getElementById('phone').value,
                    date: document.getElementById('date').value,
                    imageURL: document.getElementById('imageURL').value,
                    details: document.getElementById('details').value,
                    isCat: document.getElementById('isCat').value === "true", // Convert "true" to true
                };

                try {
                    const response = await fetch("https://pawtime-service.onrender.com/pets", {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(petData),
                    });

                    if (response.ok) {
                        const notification = document.getElementById('success-notification');
                        notification.style.display = 'block'; // Show notification
                        notification.classList.add('show'); // Add show class to display it

                        setTimeout(() => {
                            notification.classList.remove('show'); // Remove show class after 3 seconds
                            notification.style.display = 'none'; // Hide notification
                            document.getElementById('form').reset(); // Reset form
                            location.reload(); // Reload the page to show new data
                        }, 3000);

                        // Dynamically add the pet to the appropriate list
                        const petList = petData.isCat ? document.getElementById('cat-list') : document.getElementById('dog-list');
                        const petItem = document.createElement('li');
                        petItem.classList.add('product-card'); // Adding class to match card style

                        petItem.innerHTML = `
                        <div class="card-banner img-holder">
                            <img src="${petData.imageURL}" alt="${petData.name}" class="img-cover default">
                        </div>
                        <div class="card-content">
                            <div class="pet-details">
                                <p><strong>Name:</strong> ${petData.name}</p>
                                <p><strong>Weight:</strong> ${petData.weight}kg</p>
                                <p><strong>Gender:</strong> ${petData.gender}</p>
                                <p><strong>Phone:</strong> ${petData.phone}</p>
                                <p><strong>Details:</strong> ${petData.details.length > 50 ? petData.details.substring(0, 50) + '...' : petData.details}</p>
                                <div class="button-group">
                                    <button class="btn-detail" onclick="window.location.href='viewPetDetails.html?id=${petData.id}'">
                                        <i class="fas fa-info-circle"></i>
                                        <span class="tooltip">View</span>
                                    </button>
                                    <button class="btn-edit" onclick="editPet('${petData.id}')">
                                        <i class="fas fa-edit"></i>
                                        <span class="tooltip">Edit</span>
                                    </button>
                                    <button class="btn-delete" onclick="deletePet('${petData.id}')">
                                        <i class="fas fa-trash"></i>
                                        <span class="tooltip">Delete</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;

                        // Append the new pet item to the appropriate list
                        petList.appendChild(petItem);
                    } else {
                        alert(`Failed to add pet. Status code: ${response.status}`);
                    }
                } catch (error) {
                    console.error('Network error:', error);
                    alert('Could not connect to the API! Please check your server.');
                }
            });
        </script>

        </section>


        </script>
    </main>

    <script>

        function editPet(petId) {
            window.location.href = `editPet.html?id=${petId}`;
        }
        function deletePet(petId) {
            if (confirm('Are you sure you want to delete this pet?')) {
                fetch(`https://pawtime-service.onrender.com/pets/${petId}`, {
                    method: 'DELETE',
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to delete the pet');
                        }
                        // Xóa thú cưng khỏi danh sách
                        const productContainer = document.querySelector('.grid-list');
                        const petElement = productContainer.querySelector(`li[data-id="${petId}"]`);
                        if (petElement) {
                            productContainer.removeChild(petElement);
                        }

                        // Hiển thị thông báo xóa thành công
                        const notification = document.getElementById('success-notification');
                        notification.textContent = 'Pet deleted successfully!... Wait for seconds to reload the page ...'; // Thay đổi nội dung thông báo
                        notification.style.display = 'block'; // Hiển thị thông báo
                        notification.classList.add('show'); // Thêm lớp 'show' để hiển thị

                        setTimeout(() => {
                            notification.classList.remove('show'); // Xóa lớp 'show' sau 3 giây
                            notification.style.display = 'none'; // Ẩn thông báo
                            location.reload(); // Tải lại trang
                        }, 1000);
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('An error occurred while deleting the pet.');
                    });
            }
        }



    </script>


    <script src="./assets/js/script.js" defer></script>

    <!-- 
    - ionicon link
-->
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

    <script>
        document.getElementById('logoutButton').addEventListener('click', function () {
            // Clear the login flag from localStorage
            localStorage.removeItem('loggedIn');

            // Redirect to login page
            window.location.href = 'login.html';
        });
    </script>

    <script>
        const open = document.getElementById('open');
        const close = document.getElementById('close');
        const modal = document.getElementById('modal_container');

        open.addEventListener('click', () => {
            modal.classList.add('show');
        });

        close.addEventListener('click', () => {
            modal.classList.remove('show');
        });
    </script>

    <script>
        // Function to handle Pet Sitter link behavior based on user role
        function handlePetSitterAccess() {
            // Get the stored user role from localStorage
            const userRole = localStorage.getItem('userRole');

            // Get the Pet Sitter link and modal elements
            const petSitterLink = document.getElementById('open');
            const modal = document.getElementById('modal_container');
            const closeBtn = document.getElementById('close');

            if (userRole === 'pet_sitter') {
                // If user is a pet sitter, redirect directly to the PetSitter page
                petSitterLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    window.location.href = 'PetSitter.html';
                });
                // Hide the modal
                modal.style.display = 'none';
            } else {
                // For non-pet sitters, set up the modal open/close functionality
                petSitterLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    modal.classList.add('show');
                });

                closeBtn.addEventListener('click', () => {
                    modal.classList.remove('show');
                });
            }
        }

        // Run the handler when the page loads
        document.addEventListener('DOMContentLoaded', handlePetSitterAccess);
    </script>

</body>

</html>